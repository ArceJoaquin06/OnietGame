// Variables
let player;
let vidaS, vidaN = 4; //sprite y numero
let bricks;
let fire;
let meteors;
let fondo;
let isJumping = false;

function preload() {
	fondo = loadImage('/img/juego.png');
}

function setup() {
	new Canvas(1500, 800);

	// Gravedad
	world.gravity.y = 12;

	// Player
	player = new Sprite(200, 350, 28, 50);
    player.friction = 0;
    player.rotationLock = true;
	player.tile =  't'
	

	// Estructura
	// Lógica de los ladrillos
	bricks = new Group();
	bricks.w = 30;
	bricks.h = 30;
	bricks.visible = true;
	bricks.collider = 'static';
	bricks.tile = '=';
    bricks.color =  'white';

	fire = new Group();
	fire.w = 5;
	fire.h = 2;
	fire.visible = true;
	fire.tile = 'f';
    

	meteors = new Group();
	meteors.r = 10;
	meteors.visible = true;
	meteors.tile = 'm';

    coins = new Group()
    coins.d = 6;
    coins.tile = 'c';

	// Creación de los tiles
	tilesGroup = new Tiles(
		[
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=.............',
			'=..................................======..........................................................................................................................................................................',
			'=.................................==.................m...............................................................................................................................................................................',
			'=................................==...............................................................................................................................................====..........................',
			'=...............................==...............c............................................................c..................................................................=====....c.........c............',
			'=..............................==.....................................................................m.....=====...............................................................============.....========......................c..........................................................................................................',
			'=.............................==.........................................m.................................=======...................................................m.........=====.............========.................========...========....====.....................====.............====.......................................',
			'=............................==..................m........................................................=========....................m................m.....................====...............========....========.....========...========....====.....c...........====.........................====.......',
			'=..........................==...................................c....................c...................===========.........................................................====................========....========.....========...========....====....====....========..........====...........====...................',
			'==........................=.................................===========......===============............=============.........................m...........m.................====.................========....========.....========...========....====....====...====......................====....................',
			'===.t......c.............=..fffffffffffffffff...............===========ffffff===============...........===============............................................m........===fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff........................',
			'================================================================================================================================================================================================================================================================================================================================'
		],
		1,
		1,
		bricks.w + 1,
		bricks.h + 1
	);

	player.overlaps(coins, collect);
	player.overlaps(meteors, damage)

}

function damage(player, meteor) {
	meteor.remove();
}

function collect(player, coin) {
	coin.remove();
}

function draw() {
	background(200)
	image(fondo, 0, 0, (height * fondo.width) / fondo.height, height); 
	movePlayers();
	
	// Actualizar la cámara para seguir al jugado
	camera.x = player.x;  
}

function movePlayers() {
    // Controlar al jugador
    if (kb.pressing('a')) {
        player.vel.x = -4;  // Mover a la izquierda
    } else if (kb.pressing('d')) {
        player.vel.x = 4;  // Mover a la derecha
    } else {
        player.vel.x = 0;  // Detener movimiento en X
    }

    // Verificar si el jugador toca los ladrillos
    if (player.colliding(bricks)) {
        isJumping = false; // Permitir el salto nuevamente cuando toque el ladrillo
    } else {
        isJumping = true; // Establecer que el jugador está en el aire
    }

    // Lógica de salto
    if (kb.presses('w') && !isJumping) {
        player.vel.y = -7.5;  // Saltar
        isJumping = true; // Establecer que el jugador ha saltado
    }
}



